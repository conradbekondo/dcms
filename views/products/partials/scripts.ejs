<script src="/static/js/vendor/jquery-3.3.1.min.js"></script>
<script src="/static/js/vendor/bootstrap.bundle.min.js"></script>
<script src="/static/js/vendor/perfect-scrollbar.min.js"></script>
<script src="/static/js/vendor/mousetrap.min.js"></script>
<script src="/static/js/vendor/jquery.contextMenu.min.js"></script>
<script src="/static/js/dore.script.js"></script>
<script src="/static/js/scripts.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  const services = []

  $('.service_price').change(function () {
    const price = $(this).val()
    const service = $(this).data('service')
    const type = $(this).data('type')

    const index = services.findIndex(s => s.id == service && s.type == type)

    if (index > -1) services[index] = { id: service, type: type, price: price }
    else services.push({ id: service, type: type, price: price })
  })

  $('#create_form').submit(function (e) {
    e.preventDefault()

    const data = {
      name: $('#create_form #name').val(),
      category: $('#create_form #category').val(),
      icon: $('#create_form #icon').val(),
      services: services,
    }

    $.ajax({
      url: '/products',
      method: 'POST',
      data: data,
      success: (res) => {
        Swal.fire({
          title: 'Success',
          text: res.message || "Product created successfully.",
          icon: 'success'
        }).then(() => window.location.reload())
      },
      error: (err) => {
        console.error(err)
        Swal.fire({
          title: 'Error',
          text: err.responseJSON.message || "An error occurred, unable to create product.",
          icon: 'error'
        })
      }
    })
  })

  $('table').on('click', '.delete-btn', function () {
    const id = $(this).data('id')

    Swal.fire({
      title: 'Are you sure?',
      text: "You won't be able to revert this!",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, delete it!'
    }).then((result) => {
      if (result.isConfirmed) {
        $.ajax({
          url: `/products/${id}`,
          method: 'DELETE',
          success: (res) => {
            Swal.fire({
              title: 'Success',
              text: res.message,
              icon: 'success'
            }).then(() => window.location.reload())
          },
          error: (err) => {
            console.error(err)
            Swal.fire({
              title: 'Error',
              text: err.responseJSON.message || "Unable to delete product.",
              icon: 'error'
            })
          }
        })
      }
    })
  })
</script>